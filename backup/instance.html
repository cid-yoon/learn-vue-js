<html>
{{> common}}
<body class="bg-gradient-primary">
<div class="container">
    <div class="row">
        <div class="col-sm-9 col-md-7 col-lg-5 mx-auto">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title text-center">Sign In{{show}}</h5>
                    <form id="login-form">
                        <a id="kakao-login-btn"></a>
                    </form>
                    <script type='text/javascript'>
                        //<![CDATA[
                        // 사용할 앱의 JavaScript 키를 설정해 주세요.
                        Kakao.init('56f1dcc575bfcc0e884da6500f4eaec5');
                        // 카카오 로그인 버튼을 생성합니다.
                        Kakao.Auth.createLoginButton({
                            container: '#kakao-login-btn',
                            success: function (authObj) {

                                console.log(JSON.stringify(authObj));
                                console.log(Kakao.Auth.getAccessToken());
                                Kakao.Auth.getStatus(function (result) {
                                    console.log(result.status);
                                    console.log(result.user.kaccount_email);
                                    console.log(result.user.id);
                                    console.log(result.user.properties.nickname);


                                    var data = {
                                        token: Kakao.Auth.getAccessToken()
                                    };

                                    var xhr = new XMLHttpRequest();
                                    xhr.onload = function () {

                                        if (xhr.status === 200 || xhr.status === 201) {
                                            console.log(xhr.responseText);
                                            // var res = document.getElementById('test');
                                            // res.innerText = xhr.responseText;
                                            var loginForm = document.getElementById("login-form");
                                            loginForm.action = "/members/login_success";
                                            loginForm.submit();

                                        } else {
                                            console.log(xhr.responseText);
                                        }

                                    };
                                    xhr.open('POST', 'http://localhost:8888/members/');
                                    xhr.setRequestHeader('Content-Type', 'application/json'); // 컨텐츠타입을 json으로
                                    // members 요청에 대한 리스폰스 수신
                                    //
                                    xhr.send(JSON.stringify(data));
                                });

                            },
                            fail: function (err) {
                                console.log(JSON.stringify(err));
                            }
                        });
                    </script>
                    <form action="/admin/login" method="post">
                        <div class="form-label-group">
                            <input type="email" id="inputEmail" class="form-control" placeholder="Email address"
                                   required autofocus>
                            <label for="inputEmail">Email address</label>
                        </div>

                        <div class="form-label-group">
                            <input type="password" id="inputPassword" class="form-control" placeholder="Password"
                                   required>
                            <label for="inputPassword">Password</label>
                        </div>

                        <div class="custom-control custom-checkbox mb-3">
                            <input type="checkbox" class="custom-control-input" id="customCheck1">
                            <label class="custom-control-label" for="customCheck1">Remember password</label>
                        </div>
                        <button class="btn btn-lg btn-primary btn-block text-uppercase" type="submit">Sign in</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</body>
</html>